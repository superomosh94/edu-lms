<%- include('../partials/header', { title: 'Assignments - EDU LMS' }) %>
<%- include('../partials/navigation') %>

<div class="container-fluid assignments-page">
  <div class="row">
    <!-- Sidebar -->
    <aside class="col-md-3 col-lg-2 sidebar">
      <div class="sidebar-content pt-3">
        <ul class="nav flex-column">
          <li class="nav-item"><a class="nav-link" href="/dashboard"><i class="fas fa-tachometer-alt me-2"></i>Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="/courses"><i class="fas fa-book me-2"></i>Courses</a></li>
          <li class="nav-item"><a class="nav-link active" href="/assignments"><i class="fas fa-tasks me-2"></i>Assignments</a></li>
          <li class="nav-item"><a class="nav-link" href="/grades"><i class="fas fa-chart-bar me-2"></i>Grades</a></li>
          <% if (user && (user.role === 'Teacher' || user.role === 'Admin')) { %>
            <li class="nav-item"><a class="nav-link" href="/assignments/create"><i class="fas fa-plus-circle me-2"></i>Create Assignment</a></li>
          <% } %>
        </ul>

        <div class="filters mt-4">
          <h6>Filters</h6>
          <button class="btn filter-btn filter-btn-pending active" data-status="pending">Pending</button>
          <button class="btn filter-btn filter-btn-submitted" data-status="submitted">Submitted</button>
          <button class="btn filter-btn filter-btn-graded" data-status="graded">Graded</button>
          <button class="btn filter-btn filter-btn-overdue" data-status="overdue">Overdue</button>
        </div>

        <div class="courses mt-4">
          <h6>By Course</h6>
          <div class="form-check">
            <input class="form-check-input course-checkbox" type="checkbox" id="course-all" checked>
            <label class="form-check-label" for="course-all">All Courses</label>
          </div>
          <% if (courses && courses.length > 0) { %>
            <% courses.forEach(course => { %>
              <div class="form-check">
                <input class="form-check-input course-checkbox" type="checkbox" id="course-<%= course.id %>" checked>
                <label class="form-check-label" for="course-<%= course.id %>"><%= course.title %></label>
              </div>
            <% }) %>
          <% } %>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="col-md-9 col-lg-10 main-content">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1 class="h2">Assignments</h1>
          <p class="text-muted">Track upcoming, submitted, and graded assignments in one place.</p>
        </div>
        <% if (user && (user.role === 'Teacher' || user.role === 'Admin')) { %>
          <a href="/assignments/create" class="btn btn-primary"><i class="fas fa-plus me-2"></i>Create Assignment</a>
        <% } %>
      </div>

      <% if (!assignments || assignments.length === 0) { %>
        <div class="empty-state text-center">
          <div class="icon">üìù</div>
          <p>No assignments yet. Check back later.</p>
        </div>
      <% } else { %>
        <div class="row g-3 assignments-list">
          <% assignments.forEach(a => { %>
            <div class="col-lg-6 assignment-item" data-status="<%= a.status %>" data-course="<%= a.courseId %>">
              <div class="card assignment-card shadow-sm">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0"><%= a.title %></h5>
                    <span class="badge status-badge <%= a.status==='graded' ? 'graded' : a.status==='submitted' ? 'submitted' : a.status==='pending' ? 'pending' : 'overdue' %>">
                      <%= a.status %>
                    </span>
                  </div>
                  <p class="text-muted mb-2"><%= (a.description||'').substring(0,120) %>...</p>
                  <small class="text-muted">Due: <%= a.due_date || a.dueDate %></small>
                </div>
                <div class="card-footer bg-transparent text-end">
                  <a href="/assignments/view/<%= a.id %>" class="btn btn-sm btn-outline-primary">View</a>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </main>
  </div>
</div>

<%- include('../partials/footer') %>

<style>
.assignments-page {
  font-family: 'Segoe UI', sans-serif;
}
.sidebar {
  background: linear-gradient(180deg, #1e3c72, #2a5298);
  min-height: 100vh;
  padding: 15px;
  color: #fff;
}
.sidebar a.nav-link {
  color: #fff;
  transition: background 0.2s ease;
}
.sidebar a.nav-link.active {
  background: #f4a261;
  border-radius: 5px;
}
.filters {
  margin-top: 20px;
}
.filters h6 {
  color: #f0f0f0;
}
.filters button {
  width: 100%;
  margin-bottom: 5px;
  font-weight: bold;
  border: none;
  color: #fff;
  transition: transform 0.2s ease;
}
.filters button:hover {
  transform: scale(1.02);
}
.filter-btn-pending { background: #f7dc6f; color: #333; }
.filter-btn-submitted { background: #3498db; color: #fff; }
.filter-btn-graded { background: #2ecc71; color: #fff; }
.filter-btn-overdue { background: #e74c3c; color: #fff; }
.filters button.active {
  border: 2px solid #fff;
}
.main-content {
  padding: 20px;
  background: #f9f9f9;
}
.assignment-card {
  border-radius: 10px;
  transition: all 0.3s ease;
}
.assignment-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.status-badge {
  font-size: 0.75rem;
  padding: 0.3em 0.6em;
  border-radius: 5px;
}
.status-badge.pending { background: #f7dc6f; color: #333; }
.status-badge.submitted { background: #3498db; color: #fff; }
.status-badge.graded { background: #2ecc71; color: #fff; }
.status-badge.overdue { background: #e74c3c; color: #fff; }
.empty-state {
  text-align: center;
  padding: 50px;
  color: #777;
}
.empty-state .icon {
  font-size: 50px;
  margin-bottom: 10px;
}
</style>

<script>
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    filterAssignments();
  });
});

document.querySelectorAll('.course-checkbox').forEach(cb => cb.addEventListener('change', filterAssignments));

function filterAssignments() {
  const selectedStatus = document.querySelector('.filter-btn.active').dataset.status;
  const selectedCourses = Array.from(document.querySelectorAll('.course-checkbox:checked')).map(cb => cb.id.replace('course-', ''));

  document.querySelectorAll('.assignment-item').forEach(item => {
    const itemStatus = item.dataset.status;
    const itemCourse = item.dataset.course;
    const statusMatch = selectedStatus === "all" || itemStatus === selectedStatus;
    const courseMatch = selectedCourses.includes("all") || selectedCourses.includes(itemCourse);

    item.style.display = (statusMatch && courseMatch) ? "block" : "none";
  });
}

filterAssignments();
</script>
