<nav class="pagination" data-pagination-total="<%= totalPages %>">
    <style>
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin: 32px 0;
            flex-wrap: wrap;
        }

        .pagination-info {
            color: #6b7280;
            font-size: 0.9rem;
            margin: 0 16px;
            white-space: nowrap;
        }

        .page-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            height: 40px;
            padding: 0 12px;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .page-btn:hover:not(:disabled) {
            background: #f3f4f6;
            border-color: #9ca3af;
            transform: translateY(-1px);
        }

        .page-btn.active {
            background: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }

        .page-btn:disabled {
            background: #f3f4f6;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .page-btn.ellipsis {
            background: transparent;
            border: none;
            cursor: default;
        }

        .page-btn.ellipsis:hover {
            background: transparent;
            transform: none;
        }

        .pagination-nav {
            display: flex;
            gap: 8px;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .nav-btn:hover:not(:disabled) {
            background: #f3f4f6;
            border-color: #9ca3af;
            transform: translateY(-1px);
        }

        .nav-btn:disabled {
            background: #f3f4f6;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .page-input {
            width: 60px;
            height: 40px;
            padding: 0 8px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            text-align: center;
            font-size: 0.9rem;
        }

        .page-input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .go-btn {
            padding: 8px 12px;
            border: 1px solid #4f46e5;
            background: #4f46e5;
            color: white;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .go-btn:hover {
            background: #4338ca;
            border-color: #4338ca;
        }

        .pagination-size {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 16px;
        }

        .size-select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: white;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .size-select:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .pagination-stats {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-right: 16px;
            font-size: 0.85rem;
            color: #6b7280;
        }

        .pagination-compact {
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-top: 1px solid #e5e7eb;
        }

        .pagination-compact .pagination-info {
            margin: 0;
        }

        /* Mobile styles */
        .pagination-mobile {
            flex-direction: column;
            gap: 16px;
            text-align: center;
        }

        .pagination-mobile .pagination-nav {
            order: -1;
        }

        .pagination-mobile .page-numbers {
            display: flex;
            gap: 4px;
        }

        .pagination-mobile .page-btn {
            min-width: 36px;
            height: 36px;
            font-size: 0.85rem;
        }

        /* Loading state */
        .pagination.loading .page-btn,
        .pagination.loading .nav-btn {
            pointer-events: none;
            opacity: 0.6;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .page-btn {
                background: #374151;
                border-color: #4b5563;
                color: #f9fafb;
            }

            .page-btn:hover:not(:disabled) {
                background: #4b5563;
            }

            .page-btn.active {
                background: #4f46e5;
                color: white;
            }

            .page-btn:disabled {
                background: #1f2937;
                color: #6b7280;
            }

            .nav-btn {
                background: #374151;
                border-color: #4b5563;
                color: #f9fafb;
            }

            .nav-btn:hover:not(:disabled) {
                background: #4b5563;
            }

            .page-input {
                background: #374151;
                border-color: #4b5563;
                color: #f9fafb;
            }

            .size-select {
                background: #374151;
                border-color: #4b5563;
                color: #f9fafb;
            }

            .pagination-compact {
                border-top-color: #374151;
            }
        }

        /* Print styles */
        @media print {
            .pagination {
                display: none;
            }
        }
    </style>

    <% 
        const currentPage = parseInt(page) || 1;
        const totalPages = Math.ceil(total / limit);
        const showEllipsis = totalPages > 7;
        let startPage, endPage;
        
        if (totalPages <= 7) {
            startPage = 1;
            endPage = totalPages;
        } else {
            if (currentPage <= 4) {
                startPage = 1;
                endPage = 5;
            } else if (currentPage >= totalPages - 3) {
                startPage = totalPages - 4;
                endPage = totalPages;
            } else {
                startPage = currentPage - 2;
                endPage = currentPage + 2;
            }
        }
    %>

    <% if (showInfo !== false) { %>
    <div class="pagination-info">
        Showing <%= ((currentPage - 1) * limit) + 1 %> to <%= Math.min(currentPage * limit, total) %> of <%= total.toLocaleString() %> entries
    </div>
    <% } %>

    <div class="pagination-nav">
        <a 
            href="<%= currentPage > 1 ? buildPageUrl(1) : 'javascript:void(0)' %>" 
            class="nav-btn" 
            <%= currentPage <= 1 ? 'disabled' : '' %>
            title="First Page"
        >
            ⏮️ First
        </a>
        
        <a 
            href="<%= currentPage > 1 ? buildPageUrl(currentPage - 1) : 'javascript:void(0)' %>" 
            class="nav-btn" 
            <%= currentPage <= 1 ? 'disabled' : '' %>
            title="Previous Page"
        >
            ◀️ Prev
        </a>
    </div>

    <div class="page-numbers">
        <% if (showEllipsis && startPage > 1) { %>
            <a href="<%= buildPageUrl(1) %>" class="page-btn">1</a>
            <% if (startPage > 2) { %>
                <span class="page-btn ellipsis">...</span>
            <% } %>
        <% } %>

        <% for (let i = startPage; i <= endPage; i++) { %>
            <a 
                href="<%= buildPageUrl(i) %>" 
                class="page-btn <%= i === currentPage ? 'active' : '' %>"
            >
                <%= i %>
            </a>
        <% } %>

        <% if (showEllipsis && endPage < totalPages) { %>
            <% if (endPage < totalPages - 1) { %>
                <span class="page-btn ellipsis">...</span>
            <% } %>
            <a href="<%= buildPageUrl(totalPages) %>" class="page-btn"><%= totalPages %></a>
        <% } %>
    </div>

    <div class="pagination-nav">
        <a 
            href="<%= currentPage < totalPages ? buildPageUrl(currentPage + 1) : 'javascript:void(0)' %>" 
            class="nav-btn" 
            <%= currentPage >= totalPages ? 'disabled' : '' %>
            title="Next Page"
        >
            Next ▶️
        </a>
        
        <a 
            href="<%= currentPage < totalPages ? buildPageUrl(totalPages) : 'javascript:void(0)' %>" 
            class="nav-btn" 
            <%= currentPage >= totalPages ? 'disabled' : '' %>
            title="Last Page"
        >
            Last ⏭️
        </a>
    </div>

    <% if (showPageSize !== false) { %>
    <div class="pagination-size">
        <span>Show:</span>
        <select class="size-select" onchange="changePageSize(this.value)">
            <option value="10" <%= limit == 10 ? 'selected' : '' %>>10</option>
            <option value="25" <%= limit == 25 ? 'selected' : '' %>>25</option>
            <option value="50" <%= limit == 50 ? 'selected' : '' %>>50</option>
            <option value="100" <%= limit == 100 ? 'selected' : '' %>>100</option>
        </select>
    </div>
    <% } %>

    <% if (showJumpTo !== false) { %>
    <div class="pagination-jump">
        <span>Go to:</span>
        <input 
            type="number" 
            class="page-input" 
            min="1" 
            max="<%= totalPages %>" 
            value="<%= currentPage %>"
            onkeypress="handlePageInputKeypress(event, this)"
        >
        <button class="go-btn" onclick="goToPage(this.previousElementSibling.value)">Go</button>
    </div>
    <% } %>
</nav>

<script>
    function buildPageUrl(page) {
        const url = new URL(window.location.href);
        url.searchParams.set('page', page);
        <% if (params) { %>
            <% Object.keys(params).forEach(key => { %>
                url.searchParams.set('<%= key %>', '<%= params[key] %>');
            <% }); %>
        <% } %>
        return url.toString();
    }

    function changePageSize(size) {
        const url = new URL(window.location.href);
        url.searchParams.set('limit', size);
        url.searchParams.set('page', '1'); // Reset to first page
        window.location.href = url.toString();
    }

    function goToPage(page) {
        const totalPages = parseInt(document.querySelector('[data-pagination-total]').getAttribute('data-pagination-total'));
        page = parseInt(page);
        
        if (page >= 1 && page <= totalPages) {
            window.location.href = buildPageUrl(page);
        } else {
            alert(`Please enter a page number between 1 and ${totalPages}`);
        }
    }

    function handlePageInputKeypress(event, input) {
        if (event.key === 'Enter') {
            goToPage(input.value);
        }
    }

    // AJAX pagination support
    function setupAjaxPagination(containerSelector, callback) {
        const pagination = document.querySelector(containerSelector);
        if (!pagination) return;

        const links = pagination.querySelectorAll('a[href]:not([disabled])');
        links.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                if (this.hasAttribute('disabled')) return;
                
                const url = this.getAttribute('href');
                if (url === 'javascript:void(0)') return;
                
                // Show loading state
                pagination.classList.add('loading');
                
                // Fetch the page
                fetch(url, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.text())
                .then(html => {
                    if (callback && typeof callback === 'function') {
                        callback(html);
                    } else {
                        // Default behavior: replace content
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        const newContent = doc.querySelector(containerSelector);
                        if (newContent) {
                            pagination.innerHTML = newContent.innerHTML;
                            setupAjaxPagination(containerSelector, callback);
                        }
                    }
                })
                .catch(error => {
                    console.error('Pagination error:', error);
                    window.location.href = url; // Fallback to normal navigation
                })
                .finally(() => {
                    pagination.classList.remove('loading');
                });
            });
        });
    }

    // Initialize AJAX pagination if needed
    document.addEventListener('DOMContentLoaded', function() {
        const pagination = document.querySelector('.pagination');
        if (pagination && pagination.hasAttribute('data-ajax')) {
            const target = pagination.getAttribute('data-target');
            const callback = window[pagination.getAttribute('data-callback')];
            setupAjaxPagination('.pagination', callback);
        }

        // Add responsive behavior
        function handleResize() {
            const paginations = document.querySelectorAll('.pagination');
            paginations.forEach(pagination => {
                if (window.innerWidth < 768) {
                    pagination.classList.add('pagination-mobile');
                } else {
                    pagination.classList.remove('pagination-mobile');
                }
            });
        }

        handleResize();
        window.addEventListener('resize', handleResize);
    });

    // Utility function to update URL without reload
    function updatePageURL(page) {
        const url = buildPageUrl(page);
        window.history.pushState({ path: url }, '', url);
    }
</script>