<%- include('../partials/header', { title: course ? course.title : 'Course - EDU LMS' }) %>
<%- include('../partials/navigation') %>

<style>
  body { font-family: Arial, sans-serif; background: #f8f9fa; margin: 0; padding: 0; }
  .container { max-width: 1200px; margin: auto; padding: 20px; }
  .course-create, .course-hero, .course-sidebar { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 30px; }
  .course-create h4, .course-hero h1 { margin-bottom: 15px; }
  .form-label { font-weight: bold; margin-bottom: 5px; display: block; }
  input.form-control, textarea.form-control { border-radius: 5px; border: 1px solid #ddd; padding: 10px; width: 100%; }
  .btn-primary { background: #667eea; border: none; padding: 10px 20px; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; }
  .btn-primary:hover { background: #556cd6; }
  .btn-danger { background: #dc3545; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; }
  .btn-danger:hover { background: #c82333; }
  .btn-light { background: white; color: #333; padding: 8px 15px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
  .btn-light:hover { background: #eee; }
  .btn-success { background: #28a745; color: white; padding: 8px 15px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
  .btn-success:hover { background: #218838; }
  .course-hero { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; }
  .course-hero p { font-size: 1.1em; margin-bottom: 15px; }
  .badge { margin-right: 5px; font-size: 0.9em; }
  .card { border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
  .card-header { background: #f4f4f4; font-weight: bold; font-size: 1.1em; padding: 10px; }
  .lesson-item { padding: 10px; margin-bottom: 8px; border-radius: 5px; background: #fff; border-left: 4px solid #667eea; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
  .lesson-item:hover { background: #f1f1f1; }
  .course-sidebar h5 { margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
  .course-sidebar ul { list-style: none; padding: 0; }
  .course-sidebar li { padding: 8px 0; border-bottom: 1px solid #eee; }
</style>

<div class="container">

  <!-- Create Course Form -->
  <% if (user && (user.role === 'admin' || user.role === 'teacher')) { %>
    <div class="course-create">
      <h4>Create New Course</h4>
      <form action="/courses/create" method="POST">
        <div class="mb-2">
          <label class="form-label">Title</label>
          <input type="text" name="title" class="form-control" required>
        </div>
        <div class="mb-2">
          <label class="form-label">Description</label>
          <textarea name="description" class="form-control" rows="3"></textarea>
        </div>
        <div class="mb-2">
          <label class="form-label">Duration (weeks)</label>
          <input type="number" name="duration" class="form-control" required>
        </div>
        <button type="submit" class="btn-primary">Create Course</button>
      </form>
    </div>
  <% } %>

  <!-- Course Details -->
  <% if (course) { %>
    <div class="course-hero">
      <h1><%= course.title %></h1>
      <p><%= course.description %></p>
      <div>
        <span class="badge bg-light text-dark">Instructor: <%= course.instructor %></span>
        <span class="badge bg-light text-dark">Duration: <%= course.duration %> weeks</span>
        <% if (course.isEnrolled) { %>
          <span class="badge bg-success">Enrolled</span>
        <% } %>
      </div>

      <!-- Enrollment Button -->
      <% if (user && user.role === 'student') { %>
        <% if (!course.isEnrolled) { %>
          <form action="/courses/<%= course.id %>/enroll" method="POST" class="mt-3">
            <button type="submit" class="btn-light">Enroll Now</button>
          </form>
        <% } else { %>
          <button class="btn-success mt-3">Continue Learning</button>
        <% } %>
      <% } %>
    </div>

    <div class="row">
      <div class="col-lg-8">
        <% if (course.modules && course.modules.length > 0) { %>
          <% course.modules.forEach(module => { %>
            <div class="card">
              <div class="card-header"><%= module.title %></div>
              <div class="card-body">
                <% module.lessons.forEach(lesson => { %>
                  <div class="lesson-item">
                    <span><%= lesson.title %></span>
                    <span><small><%= lesson.duration %></small></span>
                  </div>
                <% }) %>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <p>No modules available.</p>
        <% } %>
      </div>

      <div class="col-lg-4">
        <div class="course-sidebar">
          <h5>Course Details</h5>
          <ul>
            <li><strong>Instructor:</strong> <%= course.instructor %></li>
            <li><strong>Duration:</strong> <%= course.duration %> weeks</li>
            <li><strong>Students Enrolled:</strong> <%= course.studentCount || 0 %></li>
          </ul>

          <!-- Admin Delete Button -->
          <% if (user && user.role === 'admin') { %>
            <form action="/courses/<%= course.id %>/delete" method="POST" style="margin-top: 15px;">
              <button type="submit" class="btn-danger">Delete Course</button>
            </form>
          <% } %>
        </div>
      </div>
    </div>
  <% } else { %>
    <p>No course selected.</p>
  <% } %>
</div>

<%- include('../partials/footer') %>
