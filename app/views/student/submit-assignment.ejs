<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - EDU LMS</title>
    <%- include('../partials/header') %>
    <style>
        .submit-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }

        .assignment-header {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #E5E7EB;
        }

        .assignment-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 0.5rem;
        }

        .assignment-meta {
            display: flex;
            gap: 2rem;
            color: #6B7280;
            font-size: 0.875rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .assignment-description {
            color: #4B5563;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .submission-form {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #E5E7EB;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        textarea.form-control {
            min-height: 200px;
            resize: vertical;
            font-family: inherit;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 500;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #2563EB;
            color: white;
        }

        .btn-primary:hover {
            background: #1D4ED8;
        }

        .btn-outline {
            background: transparent;
            color: #6B7280;
            border: 1px solid #D1D5DB;
        }

        .btn-outline:hover {
            background: #F9FAFB;
        }

        .deadline-warning {
            color: #EF4444;
            font-weight: 500;
        }

        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .alert-warning {
            background: #FEF3C7;
            color: #92400E;
            border: 1px solid #FCD34D;
        }

        .alert-info {
            background: #DBEAFE;
            color: #1E40AF;
            border: 1px solid #93C5FD;
        }

        .instructions-box {
            background: #F3F4F6;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .instructions-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        .character-count {
            font-size: 0.875rem;
            color: #6B7280;
            text-align: right;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <%- include('../partials/sidebar', { user: user, activePage: 'assignments' }) %>
    
    <div class="main-content">
        <div class="submit-container">
            <!-- Assignment Header -->
            <div class="assignment-header">
                <h1 class="assignment-title"><%= assignment.title %></h1>
                <div class="assignment-meta">
                    <span>üìÖ Due: <%= assignment.due_date ? new Date(assignment.due_date).toLocaleDateString() + ' ' + new Date(assignment.due_date).toLocaleTimeString() : 'No due date' %></span>
                    <% if (assignment.max_points) { %>
                        <span>‚≠ê <%= assignment.max_points %> points</span>
                    <% } %>
                    <span>üìö <%= assignment.course_title || 'Course' %></span>
                </div>
                
                <% if (assignment.description) { %>
                    <div class="assignment-description">
                        <strong>Description:</strong> <%= assignment.description %>
                    </div>
                <% } %>
                
                <% if (assignment.instructions) { %>
                    <div class="instructions-box">
                        <div class="instructions-title">üìã Instructions:</div>
                        <%= assignment.instructions %>
                    </div>
                <% } %>
                
                <% 
                    const dueDate = assignment.due_date;
                    const isOverdue = dueDate && new Date(dueDate) < new Date();
                    const timeLeft = dueDate ? new Date(dueDate) - new Date() : null;
                    const hoursLeft = timeLeft ? Math.floor(timeLeft / (1000 * 60 * 60)) : null;
                %>
                
                <% if (isOverdue) { %>
                    <div class="alert alert-warning">
                        <strong>‚ö†Ô∏è This assignment is overdue!</strong> Late submissions may be subject to penalties.
                    </div>
                <% } else if (hoursLeft && hoursLeft < 24) { %>
                    <div class="alert alert-info">
                        <strong>‚è∞ Deadline approaching!</strong> This assignment is due in <%= hoursLeft %> hours.
                    </div>
                <% } %>
            </div>

            <!-- Submission Form -->
            <form action="/student/assignments/<%= assignment.id %>/submit" method="POST" class="submission-form">
                <div class="form-group">
                    <label class="form-label">Your Submission Content *</label>
                    <textarea 
                        name="submissionContent" 
                        class="form-control" 
                        placeholder="Enter your assignment submission here. You can include text, code, or any other content required for this assignment..."
                        required
                        rows="12"
                        oninput="updateCharacterCount(this)"
                    ></textarea>
                    <div class="character-count">
                        <span id="charCount">0</span> characters
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Additional Notes (Optional)</label>
                    <textarea 
                        name="notes" 
                        class="form-control" 
                        placeholder="Any additional comments for your instructor, questions about the assignment, or context about your submission..."
                        rows="4"
                    ></textarea>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: flex-end; align-items: center;">
                    <a href="/student/assignments" class="btn btn-outline">
                        <i class="fas fa-arrow-left"></i> Back to Assignments
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> Submit Assignment
                    </button>
                </div>

                <div style="margin-top: 1rem; padding: 1rem; background: #FEF3C7; border-radius: 6px; font-size: 0.875rem;">
                    <strong>üìù Note:</strong> Once submitted, you cannot edit your submission. Please review your work carefully before submitting.
                </div>
            </form>
        </div>
    </div>

    <%- include('../partials/footer') %>

    <script>
        function updateCharacterCount(textarea) {
            const charCount = document.getElementById('charCount');
            charCount.textContent = textarea.value.length;
            
            // Optional: Add visual feedback for very short submissions
            if (textarea.value.length < 50) {
                charCount.style.color = '#EF4444';
            } else if (textarea.value.length < 100) {
                charCount.style.color = '#F59E0B';
            } else {
                charCount.style.color = '#10B981';
            }
        }

        // Initialize character count on page load
        document.addEventListener('DOMContentLoaded', function() {
            const textarea = document.querySelector('textarea[name="submissionContent"]');
            if (textarea) {
                updateCharacterCount(textarea);
            }
        });

        // Form submission confirmation
        document.querySelector('form').addEventListener('submit', function(e) {
            const submissionContent = document.querySelector('textarea[name="submissionContent"]').value.trim();
            
            if (submissionContent.length < 10) {
                e.preventDefault();
                alert('Please provide more substantial content for your submission (at least 10 characters).');
                return;
            }
            
            if (!confirm('Are you sure you want to submit this assignment? You cannot edit it after submission.')) {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>